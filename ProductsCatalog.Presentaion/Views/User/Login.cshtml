@model ProductsCatalog.Presentaion.View_Models.User.LoginVM


@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] تسجيل الدخول</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.2/css/bootstrap.min.css"
          integrity="sha512-usVBAd66/NpVNfBge19gws2j6JZinnca12rAe2l+d+QkLU9fiG02O1X8Q6hepIpr/EYKZvKx/I9WsnujJuOmBA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
          integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap" rel="stylesheet">

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

    <!-- Multiple Select CSS -->
    <link rel="stylesheet" href="https://unpkg.com/multiple-select@1.7.0/dist/multiple-select.min.css">

    <!-- Favicon -->
    <link href="~/Images/Shared/elogo-modified.png" rel="shortcut icon" type="image/x-icon" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/CSS/Shared/Loader.css">
    <link rel="stylesheet" href="~/CSS/Shared/snackbar.css">
    <link rel="stylesheet" href="~/CSS/Shared/Input.css">
    <link rel="stylesheet" href="~/CSS/Shared/Index.css">
    <link rel="stylesheet" href="~/CSS/Shared/XDeskModal.css">
    <link rel="stylesheet" href="~/CSS/Table/Table.css">
    <link rel="stylesheet" href="~/CSS/Shared/Sidebar.css">
    <link rel="stylesheet" href="~/css/Shared/Common.css">


    <style>
        .divider:after,
        .divider:before {
            content: "";
            flex: 1;
            height: 1px;
            background: #eee;
        }

        .h-custom {
            height: calc(100% - 73px);
        }
       
    </style>

    <!-- Render additional styles from sections -->
    @* @RenderSection("styles", required: false) *@
</head>
<body>
    <!-- Loader -->
    <div id="Pageloading">
        <div class="loader"></div>
    </div>

    <!-- Sidebar -->
    @*  <div class="XDesk_sidebar">
        @* @await Html.PartialAsync("_Sidebar") *@
    </div>

    <!-- Main Content -->
    @* <div class="XDesk_content"> *@
    <section class="vh-100">
        <div class="container-fluid h-custom">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-md-9 col-lg-6 col-xl-5">
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-login-form/draw2.webp"
                         class="img-fluid" alt="Sample image">
                </div>
                <div class="col-md-8 col-lg-6 col-xl-4 offset-xl-1">
                    <form>
                        <!-- Email input -->
                        <div data-mdb-input-init class="form-outline mb-4">
                            <input type="email" id="email" class="form-control form-control-lg"
                                   placeholder="ادخل بريدك الإلكتروني" />
                            <label class="form-label" for="email">البريد الإلكتروني</label>
                        </div>

                        <!-- Password input -->
                        <div data-mdb-input-init class="form-outline mb-3">
                            <input type="password" id="password" class="form-control form-control-lg"
                                   placeholder="ادخل كلمة المرور" />
                            <label class="form-label" for="password">كلمة المرور</label>
                        </div>

                        <div class="d-flex justify-content-between align-items-center">
                            <!-- Checkbox -->
                         @*    <div class="form-check mb-0">
                                <input class="form-check-input me-2" type="checkbox" value="" id="form2Example3" />
                                <label class="form-check-label" for="form2Example3">
                                    Remember me
                                </label>
                            </div> *@
                            @* <a href="#!" class="text-body">Forgot password?</a> *@
                        </div>

                        <div class="text-center text-lg-start mt-4 pt-2">
                            <button id="loginBtn" type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary btn-lg"
                                    style="padding-left: 2.5rem; padding-right: 2.5rem;">
                                سجل
                            </button>
                            <p class="small fw-bold mt-2 pt-1 mb-0">
                             لا يوجد لديك حساب ؟ <a href="/User/Register"
                                                          class="link-danger">سجل الآن</a>
                            </p>
                        </div>

                    </form>
                </div>
            </div>
        </div>
   @*      <div class="d-flex flex-column flex-md-row text-center text-md-start justify-content-between py-4 px-4 px-xl-5 bg-primary">
            <!-- Copyright -->
            <div class="text-white mb-3 mb-md-0">
                Copyright © 2020. All rights reserved.
            </div>
            <!-- Copyright -->
            <!-- Right -->
            <div>
                <a href="#!" class="text-white me-4">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#!" class="text-white me-4">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#!" class="text-white me-4">
                    <i class="fab fa-google"></i>
                </a>
                <a href="#!" class="text-white">
                    <i class="fab fa-linkedin-in"></i>
                </a>
            </div>
            <!-- Right -->
        </div> *@
    </section>
    @* </div> *@

    <!-- jQuery (if needed for some interactions) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Popper.js (for Bootstrap 5) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>

    <!-- Bootstrap 5 JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.2/js/bootstrap.min.js"></script>


    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <!-- Custom JS -->
    <script src="~/js/App.js"></script>

    <script>
        // Loader visibility handling
        $(window).on('beforeunload', function () {
            $('#Pageloading').css('visibility', 'visible');
        });

        window.addEventListener('pageshow', function (event) {
            if (event.persisted) {
                $('#Pageloading').css('visibility', 'hidden');
            }
        });

        $(document).ajaxStart(function () {
            $('#Pageloading').css('visibility', 'visible');
        }).ajaxStop(function () {
            $('#Pageloading').css('visibility', 'hidden');
        });

        // Snackbar logic
        var messageString = null;
        var notifyStatusVal = null;
        if (messageString) {
            Notify(messageString, notifyStatusVal);
        }
    </script>

    <script>
        $(document).ready(function () {
            $('#loginBtn').on('click', function () {

                // Get the values from the input fields
                const email = $('#email').val();
                const password = $('#password').val();

                // Validate the inputs and highlight empty fields
                let formValid = true;

                if (!email) {
                    HighlightInput($('#email')[0]); // Highlight the input field
                    Notify("من فضلك قم بإكمال جميع الحقول." , "Error");
                    formValid = false;
                }

                if (!password) {
                    HighlightInput($('#password')[0]); // Highlight the input field
                    Notify("من فضلك قم بإكمال جميع الحقول." , "Error");
                    formValid = false;
                }

                // If any required fields are empty, stop the function execution
                if (!formValid) {
                    return;
                }

             
                  // Prepare data object for AJAX
            const userDTO = {
                Email: email,
                Password: password,
            };

            console.log(userDTO);

        // Send AJAX request
                 $.ajax({
                url: '/User/Login', // Server endpoint
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(userDTO),
                success: function (response) {
                    // Check response status
                    if (!response.status) {
                        // Show the error message
                        Notify(response.message, "Error");

                        // Wait for 3 seconds (3000ms) and reload the page
                        // setTimeout(function () {
                        //     location.reload(); // Reload the page
                        // }, 3000);
                    } else {
                        Notify(response.message, "Success");

                        setTimeout(function () {
                            window.location.href = `${response.redirectUrl}`;
                        }, 2000);
                    }
                },
                error: function (xhr) {
                    Notify("حدث خطأ غير متوقع.", "Error");
                    // Handle errors if needed
                }
            });
            });
        });

        // Highlight function to add and remove the highlight class
        function HighlightInput(inputElement, timeout = 2700) {
            inputElement.classList.add('highlight'); // Use vanilla JavaScript to add class

            setTimeout(function () {
                inputElement.classList.remove('highlight'); // Use vanilla JavaScript to remove class
            }, timeout);
        }

    </script>


</body>
</html>
